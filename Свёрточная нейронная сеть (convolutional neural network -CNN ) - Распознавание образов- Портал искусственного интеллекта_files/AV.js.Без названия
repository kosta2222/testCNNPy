/* Adriver viewability 1.4.1. Developed by Alexander Nikolaev */
function AdriverViewability(e,i,t,n,s){function r(){var e,i,t={OnPage:1,Iframe:2,SameDomainIframe:3},n=0;try{if(window.top==window)return{frame:t.OnPage,topFrame:null,topFrameRef:window.location.href};for(e=window;e.parent!=e&&n<1e3;){if(i=e,e.parent.document.domain!=e.document.domain)return{frame:t.Iframe,topFrame:i,topFrameRef:i.document.referrer};e=e.parent,n++}return{frame:t.SameDomainIframe,topFrame:i,topFrameRef:e.location.href}}catch(e){}return i?{frame:t.Iframe,topFrame:i,topFrameRef:i.document.referrer}:{frame:t.Iframe,topFrame:e,topFrameRef:e.document.referrer}}function o(){try{var e=window.location.ancestorOrigins;return void 0!==e?e.length:""}catch(e){return""}}function a(e){return!isNaN(parseFloat(e))&&isFinite(e)}function h(){var e=window.navigator.userAgent;return/trident/gi.test(e)||/msie/gi.test(e)?"IE":e.search(/Firefox/)>=0?"Firefox":e.search(/Opera/)>=0||e.search(/Chrome/)>=0?"ChromeBased":e.search(/Safari/)>0?"Safari":"Other"}function l(){try{var e="desktop";return i=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0,4)))&&(e="mobile"),e}catch(e){return"undefined"}var i}if(this.browser=h(),this.platform=l(),this.win=window,this.eventLink=e,this.zeroEvent=!0,this.viewabilityEvent=!0,this.isPermanent=!1,void 0!==i&&(0!==i&&(this.isPermanent=!0),3===i?(this.viewabilityEvent=!1,this.zeroEvent=!1):2===i&&(this.zeroEvent=!1)),this.delay=n||1e3,this.startTime=(new Date).getTime(),void 0!==s&&(a(s)||s>0)&&(this.startTime=s),this.isStarted=!1,this.isFrame=r(),this.element=void 0,this.elementPar=void 0,void 0!==t)if(3===this.isFrame.frame){for(var m,c=this.isFrame.topFrame.parent.document.getElementsByTagName("IFRAME"),d=0;d<c.length;d++)c[d].contentWindow===this.isFrame.topFrame&&(m=c[d]);void 0!==m&&(this.element=m,this.win=this.isFrame.topFrame.parent.window)}else"string"==typeof t?(this.elementPar=t,document.getElementById(t)?this.element=document.getElementById(t):this.element=void 0):0!==t&&(this.element=t);if(2==this.isFrame.frame&&this.isFrame.topFrame&&(this.win=this.isFrame.topFrame),this.isViewable=!1,this.firstStart=!0,this.eventsCallbacks={},this.measurable=1,2===this.isFrame.frame&&"IE"==this.browser&&(this.measurable=0),this.tabVisible=this.isTabVisible(),this.ancestorLength=o(),this.topURL=this.parseURL(),this.historyLength="undefined"!=typeof history?history.length:"",this.zeroEvent){var v=(new Date).getTime()-this.startTime;this.sendEvent(this.eventLink,0,"161="+this.getBannerWidth()+";162="+this.getBannerHeight()+";168="+this.isFrame.frame+";176="+v+";177="+this.isMeasurable()+";213="+this.ancestorLength+";214="+this.historyLength+";163="+this.topURL)}this.callEvent("ZeroEvent"),this.startAFV()}AdriverViewability.prototype.startAFV=function(){if(!this.isStarted){if(/in/.test(document.readyState)&&1===this.isFrame.frame&&void 0===this.element&&this.firstStart)return this.firstStart=!1,void this.onLoadF(this.startAFV.bind(this));if(2===this.isFrame.frame&&this.isFrame.topFrame&&/in/.test(this.isFrame.topFrame.document.readyState)&&this.firstStart)return this.firstStart=!1,void this.onLoadF(this.startAFV.bind(this),this.isFrame.topFrame);1===this.isFrame.frame&&void 0===this.element&&void 0!==this.elementPar&&(document.getElementById(this.elementPar)?this.element=document.getElementById(this.elementPar):this.element=void 0),this.isStarted=!0,"IntersectionObserver"in window&&2==this.isFrame.frame?this.startIOCheck():2==this.isFrame.frame&&"IE"!==this.browser?this.startFrameCheck():2!==this.isFrame.frame&&void 0!==this.element&&this.startLocalCheck()}},AdriverViewability.prototype.startIOCheck=function(){var e;this.ioOptions={rootMargin:"0px",threshold:[0,.12,.25,.37,.5,.75,1]},this.ioElement,this.ioViewableProc=0,this.checkTab=function(){var e=this.isTabVisible();this.tabVisible!==e&&(e||void 0===this.ioElement.visibleTimeout?e&&this.ioViewableProc>=50&&void 0===this.ioElement.visibleTimeout&&!this.isViewable&&void 0!==this.handler&&(this.ioElement.visibleTimeout=setTimeout(this.handler,this.delay)):(clearTimeout(this.ioElement.visibleTimeout),this.ioElement.visibleTimeout=void 0)),this.tabVisible=e},this.addEvent(this.win,"visibilitychange",this.checkTab.bind(this)),this.isIOVisible=function(e,i){return i.width*i.height/(e.width*e.height)>=.5},this.visibleTimerCallback=function(){if(this.ioElement.visibleTimeout=void 0,this.processChanges(this.observer.takeRecords()),this.ioElement.isVisible&&!this.isViewable&&this.isTabVisible()){if(this.isViewable=!0,this.viewabilityEvent){var e=(new Date).getTime()-this.startTime;this.sendEvent(this.eventLink,53,"161="+this.getBannerWidth()+";162="+this.getBannerHeight()+";176="+e)}this.callEvent("ViewabilityEvent"),this.removeEvent(this.win,"visibilitychange",this.checkTab.bind(this)),this.isPermanent||this.observer.unobserve(this.ioElement)}},this.processChanges=function(e){e.forEach(function(e){this.ioElement=e.target,this.ioElement.isVisible=this.isIOVisible(e.boundingClientRect,e.intersectionRect),this.ioViewableProc=Math.round(100*e.intersectionRatio),this.ioElement.isVisible&&void 0===this.ioElement.visibleTimeout&&!this.isViewable&&(this.ioElement.visibleTimeout=setTimeout(this.handler,this.delay)),void 0===this.ioElement.visibleTimeout||this.ioElement.isVisible||(clearTimeout(this.ioElement.visibleTimeout),this.ioElement.visibleTimeout=void 0)}.bind(this))},this.handler=this.bind(this.visibleTimerCallback,this),this.pCHandler=this.bind(this.processChanges,this),this.observer=new IntersectionObserver(this.pCHandler,this.ioOptions),void 0!==this.element?e=this.element:1!==this.isFrame.frame&&(e=this.win.document.documentElement),void 0!==e&&this.observer.observe(e)},AdriverViewability.prototype.startFrameCheck=function(){function e(e){return e.contentWindow?e.contentWindow.document:e.contentDocument}this.viewableCount=0,this.isCenterVisible=!1;var i="position:absolute;width:1px;height:1px;";"Firefox"===this.browser?i+="opacity:0.01;":i+="visibility:hidden;",this.frameInfo={topLeft:{isDrawn:!1,isVisible:!1,style:i+"top:0;left:0",timer:0},topRight:{isDrawn:!1,isVisible:!1,style:i+"top:0;right:0",timer:0},bottomLeft:{isDrawn:!1,isVisible:!1,style:i+"bottom:0;left:0",timer:0},bottomRight:{isDrawn:!1,isVisible:!1,style:i+"bottom:0;right:0",timer:0},centerTop:{isDrawn:!1,isVisible:!1,style:i+"top:25%;left:50%",timer:0},centerLeft:{isDrawn:!1,isVisible:!1,style:i+"top:50%;left:25%",timer:0},centerRight:{isDrawn:!1,isVisible:!1,style:i+"top:50%;left:75%",timer:0},centerBottom:{isDrawn:!1,isVisible:!1,style:i+"top:75%;left:50%",timer:0},center:{isDrawn:!1,isVisible:!1,style:i+"top:50%;left:50%",timer:0}},this.collectInfo=function(e){try{var i=JSON.parse(e.data);void 0!==i.AFV&&(!1===this.isCenterVisible&&"center"===i.frame&&"viewable"===i.state&&(this.isCenterVisible=!0,this.checkViwability()),!0===this.isCenterVisible&&"viewable"===i.state&&(this.frameInfo[i.frame].isVisible=!0,this.frameInfo[i.frame].timer=(new Date).getTime()))}catch(e){}},this.checkViwability=function(){var e=0;for(var i in this.frameInfo){var t=(new Date).getTime();!0===this.frameInfo[i].isVisible&&(t-this.frameInfo[i].timer>300?(this.frameInfo[i].isVisible=!1,"center"===i&&(this.isCenterVisible=!1)):e++)}if(this.viewableCount=e,!0===this.isStarted&&!0===this.isCenterVisible&&!this.isViewable)if(e>=6&&this.isTabVisible()){if(this.isViewable=!0,this.viewabilityEvent){var n=(new Date).getTime()-this.startTime;this.sendEvent(this.eventLink,53,"161="+this.getBannerWidth()+";162="+this.getBannerHeight()+";176="+n)}this.callEvent("ViewabilityEvent"),this.isPermanent||this.stopAFV()}else setTimeout(this.checkViwability.bind(this),100)},this.stopAFV=function(){function e(e,i){for(var t in e){var n=i.document.getElementById("AdriverFrameViewability_"+t);void 0!==n&&n.parentNode.removeChild(n),e[t].isDrawn=!1,e[t].isVisible=!1}}this.isStarted&&(e(this.frameInfo,this.win),this.removeEvent(this.win,"message",this.collectInfo.bind(this)),this.isStarted=!1)},this.drawFrames=function(e){for(var i in e){var t=this.win.document.createElement("iframe");t.id="AdriverFrameViewability_"+i,t.style.cssText=e[i].style,this.win.document.body.appendChild(t),e[i].isDrawn=!0,this.setFrameCode(i)}},this.setFrameCode=function(i){var t=e(this.win.document.getElementById("AdriverFrameViewability_"+i));void 0!==t&&(t.write('<script>function tick(e){var t=(new Date).getTime();0!=tick0&&(delay=t-tick0,delay<=100?(viewcount++,count>0&&count--,viewcount>=61&&0===count&&(parent.postMessage&&parent.postMessage(\'{"state": "viewable","AFV": "true","frame": "'+i+'"}\',"*"),count=6)):viewcount=0),tick0=t}function ticker(){requestAnimFrame(function(){ticker(),tick()})}window.requestAnimFrame=function(e){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var tick0=0,viewcount=0,count=0;ticker()</script>'),t.close())},this.drawFrames(this.frameInfo),this.addEvent(this.win,"message",this.collectInfo.bind(this))},AdriverViewability.prototype.startLocalCheck=function(){this.localTimer=null,this.controlLocalViewability=function(){if(this.isStarted){var e=this.checkLocalViewability(this.element,this.win);this.isViewable||(e>=.5&&this.isTabVisible()?this.localTimer||(this.localTimer=setTimeout(this.localViwabilityComplete.bind(this),this.delay)):(clearTimeout(this.localTimer),this.localTimer=null))}},this.checkLocalViewability=function(e,i){function t(e){var t=n(e),o=l(e,1,i),a=r(i),h=s("h",t,o,a),m=s("v",t,o,a);return{S:t.w*t.h,curS:h*m}}function n(e){return{w:e.clientWidth,h:e.clientHeight}}function s(e,i,t,n){var s="v"===e,r=s?"h":"w",o=s?"top":"left",a=s?"ch":"cw",h=s?"st":"sl",l=0;return t[o]<n[h]?t[o]+i[r]>n[h]&&(l=t[o]+i[r]-n[h],l>n[a]&&(l=n[a])):t[o]<n[h]+n[a]&&(l=t[o]+i[r]<=n[h]+n[a]?i[r]:n[h]+n[a]-t[o]),l}function r(e){var i={},t=e.document,n=t.body,s=t.documentElement,r="CSS1Compat"==t.compatMode;return i.cw=r&&s.clientWidth||e.innerWidth||n.clientWidth,i.ch=r&&s.clientHeight||e.innerHeight||n.clientHeight,i.sl=e.pageXOffset||r&&s.scrollLeft||n.scrollLeft,i.st=e.pageYOffset||r&&s.scrollTop||n.scrollTop,i}function o(e,i,t){return e.currentStyle?e.currentStyle[i]||"":t.getComputedStyle?t.getComputedStyle(e,null)[i]||"":void 0}function a(e,i,t){var n=e.getBoundingClientRect();if(i){var s=r(t);return{left:n.left+s.sl,top:n.top+s.st}}return n}function h(e,i,t){for(var n,s=0,a=0,h=!1;e;)"fixed"===o(e,"position",t)&&(h=!0),s+=e.offsetTop,a+=e.offsetLeft,e=e.offsetParent;return i&&h?(n=r(t),{left:a+n.sl,top:s+n.st}):i||h?{left:a,top:s}:(n=r(t),{left:a-n.sl,top:s-n.st})}function l(e,i,t){var n=e.getBoundingClientRect?a(e,i,t):h(e,i,t);return{left:Math.round(n.left),top:Math.round(n.top)}}if(void 0!==e){var m=t(e);return m.curS/m.S}},this.localViwabilityComplete=function(){var e=this.checkLocalViewability(this.element,this.win);if(!this.isViewable&&e>=.5){if(this.isViewable=!0,this.viewabilityEvent){var i=(new Date).getTime()-this.startTime;this.sendEvent(this.eventLink,53,"161="+this.getBannerWidth()+";162="+this.getBannerHeight()+";176="+i)}this.callEvent("ViewabilityEvent"),this.isPermanent||this.stopLocalListen()}},this.handler=this.bind(this.controlLocalViewability,this),this.startLocalListen=function(){this.addEvent(this.win,"scroll",this.handler),this.addEvent(this.win,"resize",this.handler),this.addEvent(this.win,"visibilitychange",this.handler)},this.stopLocalListen=function(){this.removeEvent(this.win,"scroll",this.handler),this.removeEvent(this.win,"resize",this.handler),this.removeEvent(this.win,"visibilitychange",this.handler)},this.startLocalListen(),this.controlLocalViewability()},AdriverViewability.prototype.onLoadF=function(e,i){var t=i||window;/in/.test(t)&&(t.addEventListener?this.addEvent(t,"load",e):t.attachEvent("onload",e),setTimeout(e,2e3))},AdriverViewability.prototype.sendEvent=function(e,i,t){function n(e){function i(e){return(/^http:\/\//i.test(e)?e.replace(/^http:\/\//i,"https://"):/^\/\//.test(e)?"https:":"")+e}if(e=i(e).split("![rnd]").join(~~(1e6*Math.random())),document.createElement&&document.body){var t=document.createElement("img");t.style.position="absolute",t.style.display="none",t.style.width=t.style.height="0px",t.src=e,document.body.appendChild(t)}else(new Image).src=e}if(void 0!==e&&void 0!==i)return-1==e.indexOf("&type=")&&(e+="&type="),t&&-1==e.indexOf("&custom=")&&(e+="&custom="),e=e.split("&type=").join("&type="+i),t&&(e=e.split("&custom=").join("&custom="+t)),n(e),this},AdriverViewability.prototype.addEvent=function(e,i,t){e.addEventListener?e.addEventListener(i,t,!1):e.attachEvent&&e.attachEvent("on"+i,t)},AdriverViewability.prototype.removeEvent=function(e,i,t){e.removeEventListener?e.removeEventListener(i,t,!1):e.detachEvent&&e.detachEvent("on"+i,t)},AdriverViewability.prototype.bind=function(e,i){return function(){return e.apply(i,arguments)}},AdriverViewability.prototype.getViewableProc=function(){return void 0!==this.ioViewableProc?this.ioViewableProc:1!==this.isFrame.frame&&3!==this.isFrame.frame||void 0===this.checkLocalViewability?void 0!==this.viewableCount?this.viewableCount<2?0:this.viewableCount<3?12.5:this.viewableCount<5?25:this.viewableCount<6?37.5:this.viewableCount<7?50:this.viewableCount<8?75:100:0:Math.round(100*this.checkLocalViewability(this.element,this.win))},AdriverViewability.prototype.getViewability=function(){var e=this.getViewableProc();return 2===this.isFrame.frame&&"IE"===this.browser?"unmeasurable":this.isTabVisible()&&e>=50?"viewable":"unviewable"},AdriverViewability.prototype.isTabVisible=function(){return!this.win.document.hidden},AdriverViewability.prototype.isMeasurable=function(){return this.measurable},AdriverViewability.prototype.parseURL=function(){var e,i,t,n;if(e=1==this.isFrame.frame?window.location.href:this.isFrame.topFrameRef,-1!==e.indexOf("doubleclick")&&-1!==e.indexOf("betweendigital"))for(var s in-1!==e.indexOf("doubleclick")?t="url":-1!==e.indexOf("betweendigital")&&(t="ref"),n=e.split("&"),n)i=n[s].split("="),void 0!==i[1]&&""!==i[1]&&i[0]==t&&(e=i[1]);try{var r=window.location.ancestorOrigins;if(void 0===r)return encodeURIComponent(e);r=r.length>0?r[r.length-1]:void 0;var o=r.split("/")[2];return e.split("/")[2]!==o&&""!==o?encodeURIComponent(r):encodeURIComponent(e)}catch(i){return encodeURIComponent(e)}},AdriverViewability.prototype.getTopUrl=function(){return this.topURL||""},AdriverViewability.prototype.getBannerWidth=function(){try{if(1===this.isFrame.frame){if(void 0===this.element){if(void 0===this.elementPar)return"undefined";document.getElementById(this.elementPar)?this.element=document.getElementById(this.elementPar):this.element=void 0}return void 0===this.element?"undefined":this.element.getBoundingClientRect().width}return window.innerWidth}catch(e){}return"undefined"},AdriverViewability.prototype.getBannerHeight=function(){try{if(1===this.isFrame.frame){if(void 0===this.element){if(void 0===this.elementPar)return"undefined";document.getElementById(this.elementPar)?this.element=document.getElementById(this.elementPar):this.element=void 0}return void 0===this.element?"undefined":this.element.getBoundingClientRect().height}return window.innerHeight}catch(e){}return"undefined"},AdriverViewability.prototype.isFullscreenMode=function(){try{return!!(window.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||window.screenTop>0&&window.screenLeft>0&&screen.height-window.outerHeight<30&&screen.height-window.outerHeight==2*window.screenTop&&screen.width-window.outerWidth<30||window.navigator.platform.toUpperCase().indexOf("MAC")>=0&&0==window.screenTop&&0==window.screenLeft)}catch(e){}return!1},AdriverViewability.prototype.subscribe=function(e,i,t){e=e.bind(t),this.eventsCallbacks[i]=e},AdriverViewability.prototype.unsubscribe=function(e){this.eventsCallbacks[e]=null},AdriverViewability.prototype.callEvent=function(e){e in this.eventsCallbacks&&this.eventsCallbacks[e]()};var adriverviewability=adriverviewability||{};adriverviewability.v=adriverviewability.v||[],adriverviewability.v.push=function(e){try{e.call()}catch(e){}},adriverviewability.checkCalls=function(){for(var e=0;e<adriverviewability.v.length;e++)if(void 0===adriverviewability.v[e].called)try{adriverviewability.v[e].call(),adriverviewability.v[e].called=!0}catch(e){}},adriverviewability.checkCalls();